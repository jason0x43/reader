#!/bin/sh

cmd="deno run \
	--allow-net \
	--allow-env \
	--allow-read=./ \
	--allow-write=data.db,data.db-journal \
	--unstable"

if [ "$SN_MODE" = "dev" ]; then
	if [ "$1" = "serve" ]; then
		cmd="$cmd --watch --allow-run=touch"
	fi

	if [ "$SN_FAST" = "1" ]; then
		cmd="$cmd --no-check"
	else
		cmd="$cmd --no-check=remote"
	fi

	export SN_IMPORT_MAP="import_map.json"

	$cmd \
		--import-map ./$SN_IMPORT_MAP \
		mod.ts $@
else
	$cmd \
		--no-check \
		mod.ts $@
fi
